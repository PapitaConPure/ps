CodeMirror.defineSimpleMode("pureescript",{start:[{token:"comment",regex:/\/\/.*/},{token:"operator",regex:/[-+*/^%=<>!():,.]+/i},{token:["stmt-control",null,"operator",null,"symbol",null,"keyword"],regex:/\b(PARAR)(\s+)(con)(\s+)([a-zÀ-ÖØ-öø-ÿ_][0-9a-zÀ-ÖØ-öø-ÿ_]*)(\s+)(si)\b/i},{token:["stmt-control",null,"operator",null,"number",null,"keyword"],regex:/\b(PARAR)(\s+)(con)(\s+)((?!_)(?:(?:[0-9_]+(?:[.][0-9]*)?)|(?:[.][0-9]+)))(\s+)(si)\b/i},{token:["stmt-control",null,"operator",null,"string",null,"keyword"],regex:/\b(PARAR)(\s+)(con)(\s+)((?:"|').*?(?:"|'))(\s+)(si)\b/i},{token:["stmt-control",null,"symbol",null,null,null,"symbol",null,"stmt-control"],regex:/\b(PARA)(\s+)([a-zÀ-ÖØ-öø-ÿ_][0-9a-zÀ-ÖØ-öø-ÿ_]*)(\s+)(con)(\s+)([a-zÀ-ÖØ-öø-ÿ_][a-zÀ-ÖØ-öø-ÿ_0-9]*)(\s+)(MIENTRAS)\b/i,indent:!0},{token:["stmt-control",null,"symbol",null,null,null,"number",null,"stmt-control"],regex:/\b(PARA)(\s+)([a-zÀ-ÖØ-öø-ÿ_][0-9a-zÀ-ÖØ-öø-ÿ_]*)(\s+)(con)(\s+)((?!_)(?:(?:[0-9_]+(?:[.][0-9]*)?)|(?:[.][0-9]+)))(\s+)(MIENTRAS)\b/i,indent:!0},{token:["stmt-control",null,"symbol",null,null,null,"string",null,"stmt-control"],regex:/\b(PARA)(\s+)([a-zÀ-ÖØ-öø-ÿ_][0-9a-zÀ-ÖØ-öø-ÿ_]*)(\s+)(con)(\s+)((?:"|').*?(?:"|'))(\s+)(MIENTRAS)\b/i,indent:!0},{token:"stmt-control",regex:/\bPARA\s+CADA\b/i,indent:!0},{token:["stmt-control",null,"symbol",null,"keyword",null,"symbol",null,"keyword"],regex:/\b(PARA)(\s+)([a-zÀ-ÖØ-öø-ÿ_][0-9a-zÀ-ÖØ-öø-ÿ_]*)(\s+)(desde)(\s+)([a-zÀ-ÖØ-öø-ÿ_][a-zÀ-ÖØ-öø-ÿ_0-9]*)(\s+)(hasta)\b/i,indent:!0},{token:["stmt-control",null,"symbol",null,"keyword",null,"number",null,"keyword"],regex:/\b(PARA)(\s+)([a-zÀ-ÖØ-öø-ÿ_][0-9a-zÀ-ÖØ-öø-ÿ_]*)(\s+)(desde)(\s+)((?!_)(?:(?:[0-9_]+(?:[.][0-9]*)?)|(?:[.][0-9]+)))(\s+)(hasta)\b/i,indent:!0},{token:["stmt-control",null,"symbol",null,"keyword",null,"string",null,"keyword"],regex:/\b(PARA)(\s+)([a-zÀ-ÖØ-öø-ÿ_][0-9a-zÀ-ÖØ-öø-ÿ_]*)(\s+)(desde)(\s+)((?:"|').*?(?:"|'))(\s+)(hasta)\b/i,indent:!0},{token:"stmt-general",regex:/\b(BORRAR|CARGAR|COMENTAR|CREAR|DEVOLVER|DIVIDIR|EJECUTAR|USAR|ENVIAR|DECIR|EXTENDER|GUARDAR|LEER|MULTIPLICAR|PARAR|RESTAR|SUMAR|TERMINAR)\b/i},{token:"stmt-control",regex:/\b(BLOQUE|HACER|MIENTRAS|PARA|SI|REPETIR)\b/i,indent:!0},{token:"stmt-control",regex:/\b(SINO)\b/i,indent:!0,dedent:!0},{token:"stmt-control2",regex:/\b(FIN|HASTA)\b/i,dedent:!0},{token:"keyword",regex:/\b(con|en|desde|opcional|veces)\b/i},{token:"type",regex:/\b(Número|Numero|Texto|Lógico|Logico|Lista|Registro|Marco)\b/i},{token:["function","operator","type"],regex:/\b([a-zÀ-ÖØ-öø-ÿ_][0-9a-zÀ-ÖØ-öø-ÿ_]*)(\s+con\s+)(Función|Funcion)/i,indent:!0},{token:"type",regex:/\b(Función|Funcion)\b/,indent:!0},{token:"atom",regex:/\b(Verdadero|Falso|Nada)\b/i},{token:"operator",regex:/\b(es|no|precede|excede|y|o)\b/i},{token:[null,"function",null,"operator"],regex:/(\b)([a-zÀ-ÖØ-öø-ÿ_][0-9a-zÀ-ÖØ-öø-ÿ_]*)(\s*)(\()/i},{token:"symbol",regex:/\b[a-zÀ-ÖØ-öø-ÿ_][0-9a-zÀ-ÖØ-öø-ÿ_]*\b/i},{token:"number",regex:/^(?!_)(([0-9_]+([.][0-9]*)?)|([.][0-9]+))/},{token:"string",regex:/\'/,next:"stringSQ"},{token:"string",regex:/\"/,next:"stringDQ"}],stringSQ:[{token:"string",regex:/\'/,next:"start"},{token:"string2",regex:/\\[nt\\'\"]/ig},{token:"error",regex:/\\[^nt\\'\"]/ig},{token:"string",regex:/[^'\\]+/}],stringDQ:[{token:"string",regex:/\"/,next:"start"},{token:"string2",regex:/\\[nt\\'\"]/ig},{token:"error",regex:/\\[^nt\\'\"]/ig},{token:"string",regex:/[^"\\]+/}],meta:{dontIndentStates:["comment"],lineComment:"//",electricInput:/\b(SINO|HASTA|FIN)\b/i}});const scopeTokens=["BLOQUE","HACER","MIENTRAS","PARA","PARA CADA","REPETIR","SI"],unscopeTokens=["FIN","HASTA"],statementTokens=[...scopeTokens,...unscopeTokens,"SINO","BORRAR","CARGAR","COMENTAR","CREAR","DEVOLVER","DIVIDIR","EJECUTAR","ENVIAR","EXTENDER","GUARDAR","LEER","MULTIPLICAR","PARAR","RESTAR","SUMAR","TERMINAR"],typeTokens=["N\xFAmero","Texto","L\xF3gico","Lista","Registro","Marco","Funci\xF3n"],keywords=["Verdadero","Falso","Nada","con","en","desde","opcional","veces"],tokens=new Map([...statementTokens.map(n=>[n,{bias:t=>t<4?-4:2,value:n}]),...typeTokens.map(n=>[n,{bias:t=>0,value:n}]),...keywords.map(n=>[n,{bias:t=>0,value:n}])]),nativeVariableNames=(()=>{const n=a=>{const e=a.toString();let o=e.slice(e.indexOf("(")+1,e.indexOf(")")).match(/\[(.*?)\]/);return o==null||o[1]==null?"":(o=o[1],o.split(/\s*?,\s*?/g).join(", "))},t=new Pur\u00E9Script.Scope;Pur\u00E9Script.declareNatives(t);const r=new Map;for(const[a,e]of t.variables){let o;e.kind==="NativeFunction"||e.kind==="Function"?(o=`${a}()`,r.set(o,{bias:i=>0,value:o}),o=`${a}(${n(e.call)})`):o=a,r.set(o,{bias:i=>0,value:o})}return r})();function getDeclaredVariables(n){const t=n.getCursor(),r=n.getTokenAt(t),a=n.getValue().split(`
`).slice(0,t.line+1);a[a.length-1]=a[a.length-1].slice(0,r.start);const e=a.join(`
`),o=new Map,i=e.matchAll(/\b(?:(?:CREAR\s+?[a-zÀ-ÖØ-öø-ÿ_]+?\s+?)|(?:CARGAR\s+?)|(?:LEER\s+?[a-zÀ-ÖØ-öø-ÿ_]+?\s+?(?:opcional\s+?)?)|(?:PARA\s+?CADA\s+?))([a-zÀ-ÖØ-öø-ÿ_]+)/gi);for(const A of i)o.set(A[1],{bias:d=>-1,value:A[1]});return o}CodeMirror.registerHelper("hint","pureescript",function(n){const t=n.getCursor(),r=n.getTokenAt(t),a=r.start,e=r.end,o=r.string.trim();return o.length?{list:Array.from(new Map([...tokens.entries(),...nativeVariableNames.entries(),...getDeclaredVariables(n).entries()]).values()).map(d=>{const c=d.value.toLowerCase().indexOf(o.toLowerCase()),g=(d.value.length-o.length)*.25,f=a-(n.getLine(t.line).match(/^(\s*)/)?.[0].length??0);return{distance:c>=0?c+g+d.bias(f):9999,hint:d.value}}).filter(d=>d.distance<8).sort((d,c)=>d.distance-c.distance).map(d=>d.hint),from:CodeMirror.Pos(t.line,a),to:CodeMirror.Pos(t.line,e)}:{list:(a===0?Array.from(tokens.values()):new Map([...nativeVariableNames.entries(),...getDeclaredVariables(n).entries()])).map(d=>d.value),from:CodeMirror.Pos(t.line,t.ch),to:CodeMirror.Pos(t.line,t.ch)}});const editor=CodeMirror.fromTextArea(document.getElementById("editor"),{lineNumbers:!0,mode:"pureescript",theme:"psdocs",indentWithTabs:!0,electricChars:!0,scrollbarStyle:"overlay",tabSize:2,styleActiveLine:{nonEmpty:!0},extraKeys:{"Ctrl-Space":"autocomplete"},hintOptions:{hint:CodeMirror.hint.pureescript},screenReaderLabel:"Editor de c\xF3digo Pur\xE9Script"});editor.on("inputRead",function(n,t){t.text[0]&&/\w/.test(t.text[0])&&n.showHint({completeSingle:!1})});function gotoPSDocs(){window.open("https://papitaconpure.github.io/ps-docs/","_blank")}async function exportPS(){const n=editor.getDoc().getValue().trim(),t="script.tuber";if(window.showSaveFilePicker){const r=await window.showSaveFilePicker({suggestedName:"script.tuber",types:[{id:"psexport",description:"Archivo Pur\xE9Script",accept:{"text/plain":[".tuber"]}}]});let a;try{a=await r.createWritable(),await a.write(n)}finally{await a?.close()}}else{let r=prompt("Ingresa el nombre del archivo");if(r==null)return;r||(r=t),r.endsWith(".tuber")||(r+=".tuber");const a=new Blob([n],{type:"text/plain"}),e=URL.createObjectURL(a),o=document.createElement("a");o.href=e,o.download=r,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(e)}}const{lexer,parser,interpreter,Scope,EnvironmentProvider,declareNatives,declareContext,PSGuild,PSUser,stringifyPSAST,coerceValue}=Pur\u00E9Script;class BrowserEnvironmentProvider{constructor(){this.guild=new PSGuild({id:"123456789012345678",name:"Servidor de Prueba",ownerId:"123456789012345684",description:"Este ser un servidor que realmente no existe",systemChannelId:"123456789012345680",iconUrlHandler:this.#e,bannerUrlHandler:this.#e,splashUrlHandler:this.#e,premiumTier:0,channels:[{id:"123456789012345680",name:"canal-de-prueba-2",nsfw:!1}],roles:[{id:"123456789012345681",name:"Rol de Prueba 1",iconUrlHandler:t=>"https://i.imgur.com/ALNMRS6.png",color:6327539},{id:"123456789012345682",name:"Rol de Prueba 2",iconUrlHandler:t=>null}],members:[{user:new PSUser({id:"123456789012345683",username:"usuario.de.prueba",displayName:"Usuario de Prueba"}),displayAvatarUrlHandler:t=>"https://i.imgur.com/P9eeVWC.png",roleIds:["123456789012345682"]},{user:new PSUser({id:"123456789012345684",username:"otro.usuario",displayName:"Otro Usuario"}),nickname:"Otro Usuario",displayAvatarUrlHandler:t=>"https://i.imgur.com/P9eeVWC.png",roleIds:[]}]}),this.channel=this.guild.registerChannel({id:"123456789012345679",name:"canal-de-prueba-1",nsfw:!1}),this.user=new PSUser({id:"651250669390528561",username:"botdepure"}),this.member=this.guild.registerMember({user:this.user,nickname:"Bot de Pur\xE9",displayAvatarUrlHandler:t=>"https://i.imgur.com/P9eeVWC.png",roleIds:["123456789012345681","123456789012345682"]})}getGuild(){return this.guild}getChannel(){return this.channel}getUser(){return this.user}getMember(){return this.member}fetchChannel(t){if(!isNaN(+t)){const e=this.guild.channels.get(t);if(e)return e}let r=0,a=null;for(const e of this.guild.channels.values())e.name.includes(t)&&e.name.length>r&&(r=e.name.length,a=e);return a}fetchRole(t){if(!isNaN(+t)){const e=this.guild.roles.get(t);if(e)return e}let r=0,a=null;for(const e of this.guild.roles.values())e.name.includes(t)&&e.name.length>r&&(r=e.name.length,a=e);return a}fetchMember(t){if(!isNaN(+t)){const e=this.guild.members.get(t);if(e)return e}let r=0,a=null;for(const e of this.guild.members.values()){const o=i=>i&&i.includes(t)&&i.length>r?(r=i.length,a=e,!0):!1;o(e.nickname)||o(e.user.displayName)||o(e.user.username)}return a}#e(t){return""}}function sanitizeHtml(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function markup(n){const t="<<<PART/CODE/BLOCK>>>",r="<<<PART/CODE/INLINE>>>",a=[];return sanitizeHtml(n).replace(/```([a-z0-9]{0,4})?\n((?:.|\n)+?)```/gi,(e,o,i)=>(i=i.replace(/\n/g,"<br>"),a.push({lang:o,code:i}),t)).replace(/\`([^`]+)\`/g,(e,o)=>(o=o.replace(/\n/g,"<br>"),a.push({code:o}),r)).replace(/^([\t ]*?)([-*]|(?:[0-9]+\.)) (.+)$/gm,(e,o,i,A)=>{const d=i==="*"||i==="-"?"ul":"ol",c=d==="ul"?"\u2022":i,f=o.replace(/  /g,"	").length;return(f?`<span class="list-indent" style="width:${.5*f}rem"></span>`:"")+`<span class="list-order" style="width:${d==="ul"?.5:1}rem">${c}</span><${d}">${A}</${d}>`}).replace(/^( +?)\* (.+)/gm,"<li>$1</li>").replace(/^### (.+)/gm,"<h3>$1</h3>").replace(/^## (.+)/gm,"<h2>$1</h2>").replace(/^# (.+)/gm,"<h1>$1</h1>").replace(/^-# (.+)/gm,'<div class="disclaimer">$1</div>').replace(/^&gt; (.+)/gm,'<div class="quote">$1</div>').replace(/\n ?<([a-z0-9])/gi,"<$1").replace(/([a-z0-9])> ?\n/gi,"$1>").replace(/\*\*([^*]+)\*\*/g,"<b>$1</b>").replace(/\*([^*]+)\*/g,"<i>$1</i>").replace(/__([^_]+)__/g,'<span class="underline">$1</span>').replace(/_([^_]+)_/g,"<i>$1</i>").replace(/~~([^~]+)~~/g,'<span class="line-through">$1</span>').replace(/\|\|([^\|]+)\|\|/g,'<span class="spoiler">$1</span>').replace(/\[(.+?)\]\((.+?)\)/g,'<a href="$2">$1</a>').replaceAll(t,()=>`<code class="block w-full">${a.shift().code}</code>`).replaceAll(r,()=>`<code>${a.shift().code}</code>`).replace(/\n/g,"<br>")}function groupQuoted(n){const t=[];let r=!1,a=[];for(let e of n)e.startsWith('"')&&!r?(r=!0,a.push(e.slice(1))):e.endsWith('"')&&r&&!e.endsWith('\\"')?(a.push(e.slice(0,-1)),t.push(a.join(" ").trim()),a=[],r=!1):r?a.push(e):t.push(e);return r&&t.push(a.join(" ")),t}function createSendButton(n){const t=document.createElement("button"),r=document.createElement("i");return r.classList.add("fa","fa-paper-plane"),t.ariaLabel="Volver a ejecutar orden",t.appendChild(r),t}let savedData=new Map,messagesToAppend=[],busyOutput=!1,lastInput=null;setInterval(function(){if(!busyOutput)return;const n=messagesToAppend.shift();if(!n){busyOutput=!1;return}n()},80);const MessageKinds={text:{className:"message-text",icon:"fa-comment"},embed:{className:"message-embed",icon:null},error:{className:"message-error",icon:"fa-circle-exclamation"},return:{className:"message-return",icon:"fa-share-from-square"},input:{className:"message-input",icon:"fa-keyboard"}};function initOutput(n){const t=document.getElementById("output");if(!t)return console.warn("No output container was found (#output)"),{success:!1,outputCont:null,sendMessage:()=>{}};n&&(messagesToAppend=[],t.innerHTML="",savedData=new Map,lastInput=null);function r(a){const{kind:e,data:o}=a,i=document.createElement("div");if(i.classList.add("message",MessageKinds[e].className),e==="embed"){const{author:d,color:c,url:g,title:f,description:h,fields:w,imageUrl:u,thumbUrl:y,footer:b}=o;if(c&&(isNaN(c)?Array.isArray(c)?i.style.borderLeftColor=`rgb(${c[0]}, ${c[1]}, ${c[2]})`:c==="Random"?i.style.borderLeftColor=`rgb(${Math.floor(Math.random()*256)}, ${Math.floor(Math.random()*256)}, ${Math.floor(Math.random()*256)})`:typeof c=="string"&&c.startsWith("#")&&c.length>=3&&(i.style.borderLeftColor=c):i.style.borderLeftColor=`#${c.toString(16)}`),!d&&!f&&!h){if(y){const l=document.createElement("img");l.style.width>l.style.height?l.style.width="96px":l.style.height="96px",l.style.margin="0 0 0.25rem auto",l.src=y,l.alt="Miniatura",l.loading="lazy",l.decoding="async",l.fetchPriority="low",i.appendChild(l)}}else{const l=document.createElement("div");l.classList.add("message-embed-hgroup");const p=document.createElement("div");if(d){const s=document.createElement(d.url?"a":"div");if(s.classList.add("message-embed-author"),d.iconUrl){const m=document.createElement("img");m.src=d.iconUrl,m.alt="\xCDcono de autor",m.loading="lazy",m.decoding="async",m.fetchPriority="low",s.appendChild(m);const E=document.createElement("span");E.textContent=d.name,s.appendChild(E)}else s.textContent=d.name;d.url&&(s.href=d.url),p.appendChild(s)}if(f){const s=document.createElement(g?"a":"h2");s.classList.add("message-embed-title"),s.textContent=f,g&&(s.href=g),p.appendChild(s)}if(h){const s=document.createElement("p");s.innerHTML=markup(h),p.appendChild(s)}if(l.appendChild(p),y){const s=document.createElement("img");s.style.width>s.style.height?s.style.width="96px":s.style.height="96px",s.style.margin="0 0 0.25rem 0.25rem",s.src=y,s.alt="Miniatura",s.loading="lazy",s.decoding="async",s.fetchPriority="low",l.appendChild(s)}i.appendChild(l)}if(w){const l=document.createElement("table"),p=[];let s={names:[],values:[]};p.push(s.names,s.values);for(const m of w)!m.inline&&s.names.length!==0&&(s={names:[],values:[]},p.push(s.names,s.values)),s.names.push(m.name),s.values.push(m.value),(!m.inline||s.names.length===3)&&(s={names:[],values:[]},p.push(s.names,s.values));for(let m=0;m<p.length;m++){const E=document.createElement("tr");for(const R of p[m]){const k=document.createElement(m%2===0?"th":"td");k.innerHTML=markup(R),E.appendChild(k)}l.appendChild(E)}i.appendChild(l)}if(u){const l=document.createElement("img");l.src=u,l.alt="Imagen",l.loading="lazy",l.decoding="async",l.fetchPriority="low",i.appendChild(l)}if(b){const l=document.createElement("div");l.classList.add("message-embed-footer");const p=document.createElement("div");if(b.iconUrl){const s=document.createElement("img");s.src=b.iconUrl,s.loading="lazy",s.decoding="async",s.fetchPriority="low",s.alt="\xCDcono de pie",l.appendChild(s)}p.textContent=b.text,l.appendChild(p),i.appendChild(l)}}else{const d=document.createElement("i");d.classList.add("message-icon","fa",MessageKinds[e].icon),i.appendChild(d);const c=document.createElement(e==="input"?"textarea":"div");if(c.style.overflowX="hidden",e==="error"){const g=document.createElement("h2");g.textContent=o.name??"Error";const f=document.createElement("p");f.classList.add("message-content"),f.innerHTML=o.message?markup(o.message.replace(/\t/g," ")):"Error desconocido",c.appendChild(g),c.appendChild(f)}else o&&(c.classList.add("message-text"),e==="input"?(c.innerHTML=lastInput==null?sanitizeHtml(o):"",c.addEventListener("focus",g=>c.select(),{passive:!0})):c.innerHTML=markup(o));if(i.appendChild(c),e==="input"){c.name="entradas",c.ariaLabel="Ingresa entradas de re-ejecuci\xF3n separadas por espacios aqu\xED",lastInput=c;const g=createSendButton(e);i.appendChild(g);async function f(h,w){const u=w.value.replace(/^\s+|\s+$/,""),y=u.length?groupQuoted(u.split(/\s+/)):[],b=await executePS(y);if(w.disabled=!0,w.removeEventListener("focus",l=>c.select()),h.disabled=!0,h.classList.add("sent"),!b){const l=document.createElement("div");l.classList.add("message",MessageKinds[e].className);const p=document.createElement("i");p.classList.add("message-icon","fa",MessageKinds[e].icon),l.appendChild(p);const s=document.createElement("textarea");s.name="entradas",s.innerHTML="",s.ariaLabel="Ingresa entradas de re-ejecuci\xF3n separadas por espacios aqu\xED",s.classList.add("message-text"),lastInput=s,l.appendChild(s);const m=createSendButton(e);l.appendChild(m),messagesToAppend.push(()=>{t.appendChild(l),messagesToAppend.length===0&&t.scrollTo({top:t.scrollHeight,behavior:"smooth"}),e==="input"&&setTimeout(E=>s!=null&&!s.disabled&&s.focus(),320+80*A)}),busyOutput=!0,m.addEventListener("click",E=>f(m,s),{once:!0,passive:!0}),s.addEventListener("keydown",function(E){return E.key!=="Enter"||E.shiftKey?!0:(f(m,s),!1)},{passive:!0})}}g.addEventListener("click",h=>f(g,c),{once:!0,passive:!0}),c.addEventListener("keydown",function(h){return h.key!=="Enter"||h.shiftKey?!0:(f(g,c),!1)},{passive:!0})}}const A=messagesToAppend.length;messagesToAppend.push(()=>{t.appendChild(i),messagesToAppend.length===0&&t.scrollTo({top:t.scrollHeight,behavior:"smooth"}),e==="input"&&setTimeout(d=>lastInput!=null&&!lastInput.disabled&&lastInput.focus(),320+80*A)}),busyOutput=!0}return{success:!0,outputCont:t,sendMessage:r}}function stringifyValue(n){return n.kind==="Nada"?"Nada":coerceValue(interpreter,n,"Text").value}async function executePS(n=void 0){const t=editor.getDoc().getValue().trim(),r=n==null,{success:a,sendMessage:e}=initOutput(r);if(!a)return console.error("Output container was not properly initialized"),!1;try{const i=lexer.tokenize(t),A=parser.parse(i),d=new Scope(interpreter),c=new BrowserEnvironmentProvider;declareNatives(d),await declareContext(d,c,savedData);const g=interpreter.evaluateProgram(A,d,t,c,n,r);if(!g.sendStack.length){const u=new Error("No se envi\xF3 ning\xFAn mensaje");throw u.name="TuberSendError",u}if(!g.sendStack.length){const u=new Error("Demasiados embeds");throw u.name="TuberSendError",u}const f=[],h=[];for(const u of g.sendStack)u.kind==="Embed"?h.push(u.value):f.push(stringifyValue(u));const w=f.join(`
`).trim("");if(!w.length&&!h.length){const u=new Error("No se envi\xF3 ning\xFAn mensaje");throw u.name="TuberSendError",u}for(const[u,y]of g.saveTable)if(y.kind==="Nada")savedData.delete(u);else{let b=function(l){const p={kind:l.kind};if(l.value!=null&&(p.value=l.value),l.elements!=null&&(p.elements=l.elements.map(s=>b(s))),l.entries!=null){p.entries={};for(const[s,m]of l.entries)p.entries[s]=b(m)}return p};var o=b;savedData.set(u,b(y))}f&&e({kind:"text",data:w});for(const u of h){const{author:y,title:b,description:l,fields:p,imageUrl:s,thumbUrl:m,footer:E}=u.data;if(y||b||l||p?.length||s||m||E)e({kind:"embed",data:u.data});else{const R=new Error("Se envi\xF3 un Marco vac\xEDo que fallar\xE1 en Discord");R.name="TuberSendError",e({kind:"error",data:R})}}return e({kind:"return",data:stringifyValue(g.returned)}),e({kind:"input",data:g.inputStack.map((u,y)=>u.spread?`${u.name}_0 ${u.name}_1 ... ${u.name}_N`:u.name).join(" ")}),!0}catch(i){return console.error(i),e({kind:"error",data:{name:typeof i=="string"?i:i.name,message:i.message??"Este error no ofrece informaci\xF3n adicional"}}),!1}}const fetchedTemplates=new Map;async function fetchTemplate(n){const t=fetchedTemplates.get(n);let r;if(t)r=t;else{const e=await fetch(n);if(e.status!==200)return{status:e.status,statusText:e.statusText,result:null};r=await e.text(),fetchedTemplates.set(n,r)}const a=document.createElement("div");return a.innerHTML=r,{status:200,statusText:"OK",result:a.querySelector("template")}}function toggleModal(n=null){const t=document.getElementById("modal-backdrop"),r=document.getElementById("modal-window"),a=n==null?!t.dataset.hidden:!n;a?t.dataset.hidden=!0:delete t.dataset.hidden;const e=["scale-0","opacity-0"];return setTimeout(()=>{a?e.forEach(o=>!r.classList.contains(o)&&r.classList.add(o)):e.forEach(o=>r.classList.contains(o)&&r.classList.remove(o))},1),!a}async function loadModalContent(n){const t=document.getElementById("modal-window"),r=document.getElementById("modal-content"),a=document.getElementById("modal-buttons");r.innerHTML="",a.innerHTML="",!t.classList.contains("animate-pulse")&&t.classList.add("animate-pulse");let e=await fetchTemplate(n);if(e.status!==200){console.error(e.status,e.statusText);return}t.classList.contains("animate-pulse")&&t.classList.remove("animate-pulse"),r.replaceChildren(e.result.content),r.querySelectorAll(".btn-modal").forEach(i=>{a.appendChild(i)}),(r.querySelector("#modal-focus")??a.firstElementChild??a)?.focus()}document.body.addEventListener("keydown",function(n){if(n.key==="F1")return window.onhelp=function(){return alert(),!1},n.stopPropagation(),n.preventDefault(),gotoPSDocs(),!1;if(!n.ctrlKey)return!0;switch(n.key){case"/":return toggleModal()&&loadModalContent("components/keybinds-modal-content"),!1;case"Enter":return executePS(),!1;case"E":case"e":return n.shiftKey?(exportPS(),!1):!0;case"H":case"h":return n.shiftKey?(gotoPSDocs(),!1):!0;case"ArrowLeft":case"Left":return n.altKey?(editor.focus(),!1):!0;case"ArrowRight":case"Right":return n.altKey?((document.querySelector(".message.message-input textarea:enabled")??document.getElementById("output"))?.focus(),!1):!0}return!0},{passive:!0}),document.getElementById("modal-backdrop").addEventListener("keydown",n=>n.key!=="Enter"&&n.key!=="Escape"?!0:(toggleModal(!1),!1)),setTimeout(executePS,200),(async()=>{const n=["components/bdp-modal-content","components/keybinds-modal-content"];await Promise.all(n.map(async t=>{const r=await fetch(t);if(r.status===200){const a=await r.text();fetchedTemplates.set(t,a)}}))})();
